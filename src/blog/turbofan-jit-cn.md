***

标题： “挖掘涡轮风扇JIT”
作者：“Ben L. Titzer，软件工程师和TurboFan Mechanic”
化身：

*   “本-蒂策尔”
    日期： 2015-07-13 13：33：37
    标签：
*   内部
    描述： “深入了解 V8 新款 TurboFan 优化编译器的设计。

***

[上周我们宣布](https://blog.chromium.org/2015/07/revving-up-javascript-performance-with.html)我们已经为某些类型的JavaScript启用了TurboFan。在这篇文章中，我们想更深入地研究TurboFan的设计。

性能一直是V8战略的核心。TurboFan将尖端的中间表示与多层转换和优化管道相结合，以生成比以前使用CrankShaft JIT更高质量的机器代码。TurboFan中的优化比曲轴中的优化更多，更复杂，应用得更彻底，从而实现流体代码运动，控制流优化和精确的数值范围分析，所有这些都是以前无法实现的。

## 分层架构

随着时间的推移，编译器往往会变得复杂，因为支持新的语言功能，添加新的优化，并针对新的计算机体系结构。借助 TurboFan，我们从许多编译器中吸取了经验教训，并开发了一个分层架构，使编译器能够随着时间的推移应对这些需求。源代码级语言 （JavaScript）、VM 的功能 （V8） 和架构的复杂性（从 x86 到 ARM 再到 MIPS）之间更清晰的分离，可以实现更清晰、更健壮的代码。分层允许那些在编译器上工作的人在实现优化和功能时在本地推理，以及编写更有效的单元测试。它还保存代码。TurboFan 支持的 7 种目标架构中的每一种都需要不到 3，000 行特定于平台的代码，而 CrankShaft 则需要 13，000-16，000 行代码。这使得ARM，Intel，MIPS和IBM的工程师能够以更有效的方式为TurboFan做出贡献。TurboFan能够更轻松地支持ES6的所有即将推出的功能，因为它的灵活设计将JavaScript前端与依赖于架构的后端分开。

## 更复杂的优化

TurboFan JIT通过许多先进的技术实现了比曲轴更积极的优化。JavaScript以一种大部分未优化的形式进入编译器管道，并被翻译和优化为逐渐降低的形式，直到生成机器代码。设计的核心是代码的更轻松的节点海洋内部表示（IR），允许更有效的重新排序和优化。

![Example TurboFan graph](../_img/turbofan-jit/example-graph.png)

数值范围分析有助于TurboFan更好地理解数字运算代码。基于图形的 IR 允许将大多数优化表示为简单的局部约简，这些缩减更易于独立编写和测试。优化引擎以系统和彻底的方式应用这些局部规则。转换出图形表示涉及一种创新的调度算法，该算法利用重新排序的自由度将代码移出循环并移动到执行频率较低的路径中。最后，特定于架构的优化（如复杂的指令选择）利用每个目标平台的功能来获得最高质量的代码。

## 提供更高水平的性能

我们是[已经看到了一些很棒的加速](https://blog.chromium.org/2015/07/revving-up-javascript-performance-with.html)使用TurboFan，但仍有大量的工作要做。请继续关注，因为我们启用了更多优化并打开了TurboFan以获取更多类型的代码！
